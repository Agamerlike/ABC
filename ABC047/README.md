# ABC047
Atcoder Beginner Contest047の自分の解答

400点問題が通せないつらい

# A
ノーコンパイルチャレンジ成功。

# B
Bにしては複雑だと思う。

上下左右の白く塗られた部分と黒く塗られた部分の境目をそれぞれ求める。これは制約から左と下についてはx[i],y[i]の最大値、右と上についてはx[i],y[i]の最小値を取ってくればよいことが分かる。こうして求まった境目に対して、(右-左)\*(上-下)で白く塗られた部分の面積が求まる。当然面積に負の値はないので、負の値が出た時は0である。

ただし、右-左,上-下の双方が負であった場合は普通にかけ算してしまうと正の値が出てしまうので、結局それぞれについて負の数かどうか確認することになる。

# C
白に替えなければならないと誤読していて1WA。この誤読で大きくアルゴリズムが変化してしまうことがなかったので九死に一生。

全部白（黒）に替えることを考えたとき、1回で替えれない場合を考える。これは非常に簡単で、`WBW`もしくは`BWWWB`のように一方の色でもう一方の色が囲まれている場合である。同じ色が連続している部分に関してはまとめて色を変えられるため無視してよい。両側にしか新しく石を置けない以上、このネストは外側から順番にほどくしかないのでこの囲みが深くなるのに比例して答えも増大すると考えられる。

ここで黒→白もしくは白→黒の並びをひとかたまりとする。これをひとかたまりとしたとき、色のパターンは`WBBWBWBBWWBB`のようにこのかたまりのみで構成される場合と``WWBBWBWBWWWBW`のように末尾に先にくるものが残ってしまう場合の2通りがある。結論だけ言うと、前者より後者のほうが1回余分にかかり（最後のネストが完成しているため）、前者はかたまり数\*2-1,後者はかたまり数\*2だけの手数がかかる。

一応最初すべて白もしくは黒の場合は別にして計算したが（自明的に0）、その必要はなさそうだ。

# D
見通しは立ったが調べたアルゴリズムの動作が理解できなかったのでWAとする。

最大の利益が出る組み合わせの買う方を1値上げするか売る方を1値下げするかが最適である。最大の利益が出る組み合わせが複数存在する時はmin(買う方の種類,売る方の種類)の町の数だけ値上げもしくは値下げすることになる。

利益が出る組み合わせとは売る-買うが+になる組み合わせなので全体の差分を取る。差分が+であれば利益が出て、-であれば利益が出ない。ここで求めるのは、差分の累積和が最大になる区間が何通り存在するかである。愚直に行うとO(N^2)となり厳しい。

いかにもな問題にまで落とし込めたので調べてみると、どうやら走査アルゴリズム（両側から最大値を求める）というものでO(N)を実現できるらしいことがわかった。しかしソースコードを読んでもなぜそれで最大値が出るのかが分からなかったし、その疑問を解消しようとすると結局O(N^2)解法になってしまう。。。

### 追記（解説見た）
ポイントは以下の2点だった。

* これまで見てきた値の最小値さえ保持しておけばその値までの差の最大値は容易に求まる。

* 差の最大値が複数存在するとき最小値の位置が違えば当然最大値の位置も異なる。つまり保持すべきは最小値のindexである。

累積和に飛びついたのが敗因だったと思われる。

固定配列の最大値を求めたい時は`m=*max_element(a,a+n);`。ポインタ怖い